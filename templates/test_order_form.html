<!DOCTYPE html>
<html>
<head>
    <title>Test Order Form - OrderDesk Integration</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        button { background: #007cba; color: white; padding: 12px 24px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #005a87; }
        .product-info { background: #f5f5f5; padding: 15px; margin: 15px 0; border-radius: 4px; }
        .order-summary { margin-top: 20px; padding: 20px; border: 2px solid #28a745; border-radius: 8px; }
        .success-message { background: #d4edda; color: #155724; padding: 15px; border-radius: 4px; margin: 20px 0; }
        .error-message { background: #f8d7da; color: #721c24; padding: 15px; border-radius: 4px; margin: 20px 0; }
    </style>
</head>
<body>
    <h1>Test Order Form - OrderDesk Integration</h1>
    
    <div class="product-info">
        {% if no_image_selected %}
        <h3 style="color: #d9534f;">No Image Selected</h3>
        <p style="color: #d9534f; font-weight: bold;">Please go to the <a href="/" style="color: #007cba;">gallery</a> and select an image first, then click ORDER PRINTS.</p>
    {% else %}
        <h3>Image Name: {{ image }}</h3>
        {% if imageSize %}<p><strong>Image Size:</strong> {{ imageSize }}</p>{% endif %}
    {% endif %}
        <p><strong>Product:</strong> Canvas Print 12x12</p>
        {% if image %}<p><strong>Image:</strong> https://fifthelement.photos/images/{{ image }}.jpg</p>{% endif %}
    </div>

    {% if not no_image_selected %}
    <form action="/test_order_submit" method="POST" id="orderForm">
        <h3>Customer Information</h3>
        
        <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" id="email" name="email" value="test@example.com" required>
        </div>

        <h3>Shipping Address</h3>
        
        <div class="form-group">
            <label for="first_name">First Name:</label>
            <input type="text" id="first_name" name="first_name" value="Test" required>
        </div>
        
        <div class="form-group">
            <label for="last_name">Last Name:</label>
            <input type="text" id="last_name" name="last_name" value="Customer" required>
        </div>
        
        <div class="form-group">
            <label for="address1">Address:</label>
            <input type="text" id="address1" name="address1" value="123 Test Street" required>
        </div>
        
        <div class="form-group">
            <label for="city">City:</label>
            <input type="text" id="city" name="city" value="Test City" required>
        </div>
        
        <div class="form-group">
            <label for="state">State:</label>
            <input type="text" id="state" name="state" value="CA" required>
        </div>
        
        <div class="form-group">
            <label for="postal_code">Zip Code:</label>
            <input type="text" id="postal_code" name="postal_code" value="90210" required>
        </div>
        
        <div class="form-group">
            <label for="country">Country:</label>
            <select id="country" name="country" required>
                <option value="US" selected>United States</option>
                <option value="CA">Canada</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="phone">Phone:</label>
            <input type="tel" id="phone" name="phone" value="555-123-4567">
        </div>

        <h3>Product Selection</h3>
        
        <div class="form-group">
            <label for="product_type">Product Type:</label>
            <select id="product_type" name="product_type" required onchange="updateProductInfo()">
                <option value="canvas|12x12_075" data-sku="101001" data-options="1,5" selected>Canvas Print 0.75" (12x12) - $25.00</option>
                <option value="canvas|12x12_125" data-sku="101002" data-options="2,5">Canvas Print 1.25" (12x12) - $30.00</option>
                <option value="metal|12x12" data-sku="106001" data-options="29,31">Metal Print (12x12) - $35.00</option>
                <option value="paper|12x12" data-sku="103001" data-options="36">Fine Art Paper (12x12) - $20.00</option>
                <option value="framed_canvas_15|12x12" data-sku="102001" data-options="1,5" data-has-variants="true">Framed Canvas 1.5" (12x12) - $45.00</option>
            </select>
        </div>
        
        <!-- Frame Selection (only shows for framed canvas products) -->
        <div class="form-group" id="frame-selection" style="display: none;">
            <label for="frame_type">Frame Type:</label>
            <select id="frame_type" name="frame_type" onchange="updateFrameSelection()">
                <option value="maple" selected>Maple Wood Floating Frame</option>
                <option value="espresso">Espresso Floating Frame</option>
                <option value="natural">Natural Wood Floating Frame</option>
                <option value="oak">Oak Floating Frame</option>
                <option value="gold">Gold Floating Frame</option>
                <option value="silver">Silver Floating Frame</option>
                <option value="white">White Floating Frame</option>
                <option value="black">Black Floating Frame</option>
            </select>
        </div>

        <!-- Hidden fields for OrderDesk -->
        <input type="hidden" id="product_sku" name="product_sku" value="101001">
        <input type="hidden" id="lumaprints_options" name="lumaprints_options" value="1,5">
        <input type="hidden" id="product_price" name="product_price" value="25.00">

        <!-- Order Summary Section -->
        <div class="order-summary">
            <h3>Order Summary</h3>
            <p><strong>Product:</strong> <span id="product-display">Canvas Print 0.75" (12x12)</span></p>
            <p><strong>Total: <span id="total-price">$25.00</span></strong></p>
            <div style="font-size: 0.9em; color: #666; margin-bottom: 15px;">
                <div>Test Order - No Payment Required</div>
            </div>
        </div>

        <!-- Submit Button -->
        <button type="submit" id="submit-order" style="margin-top: 20px;">Submit Test Order to OrderDesk</button>
    </form>
    {% endif %}

    <!-- Success/Error Messages -->
    <div id="message-container"></div>
    
    <script>
        // Update product info when selection changes
        function updateProductInfo() {
            const select = document.getElementById('product_type');
            const selectedOption = select.options[select.selectedIndex];
            
            if (selectedOption.value) {
                const [productType, variantKey] = selectedOption.value.split('|');
                const sku = selectedOption.getAttribute('data-sku');
                const options = selectedOption.getAttribute('data-options');
                const hasVariants = selectedOption.getAttribute('data-has-variants') === 'true';
                const displayName = selectedOption.textContent.split(' - ')[0];
                const price = selectedOption.textContent.split('$')[1];
                
                // Show/hide frame selection based on product type
                const frameSelection = document.getElementById('frame-selection');
                if (hasVariants && productType === 'framed_canvas_15') {
                    frameSelection.style.display = 'block';
                } else {
                    frameSelection.style.display = 'none';
                }
                
                // Update hidden fields
                document.getElementById('product_sku').value = sku;
                document.getElementById('lumaprints_options').value = options;
                document.getElementById('product_price').value = price;
                
                // Update display
                updateProductDisplay();
            }
        }
        
        function updateFrameSelection() {
            // Update display when frame type changes
            updateProductDisplay();
        }
        
        function updateProductDisplay() {
            const productSelect = document.getElementById('product_type');
            const frameSelect = document.getElementById('frame_type');
            const selectedProduct = productSelect.options[productSelect.selectedIndex];
            
            if (selectedProduct.value) {
                let displayName = selectedProduct.textContent.split(' - ')[0];
                const price = selectedProduct.textContent.split('$')[1];
                
                // If frame selection is visible, append frame type to display name
                const frameSelection = document.getElementById('frame-selection');
                if (frameSelection.style.display !== 'none') {
                    const selectedFrame = frameSelect.options[frameSelect.selectedIndex];
                    displayName += ' - ' + selectedFrame.textContent;
                }
                
                // Update display
                document.getElementById('product-display').textContent = displayName;
                document.getElementById('total-price').textContent = '$' + price;
            }
        }

        // Handle form submission
        document.getElementById('orderForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const submitButton = document.getElementById('submit-order');
            submitButton.disabled = true;
            submitButton.textContent = 'Submitting Order...';
            
            const formData = new FormData(this);
            
            fetch('/test_order_submit', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                const messageContainer = document.getElementById('message-container');
                
                if (data.success) {
                    messageContainer.innerHTML = `
                        <div class="success-message">
                            <h4>Order Submitted Successfully!</h4>
                            <p><strong>OrderDesk Order ID:</strong> ${data.order_id}</p>
                            <p>Your test order has been submitted to OrderDesk. Check the OrderDesk dashboard to see if it forwards to Lumaprints.</p>
                        </div>
                    `;
                } else {
                    messageContainer.innerHTML = `
                        <div class="error-message">
                            <h4>Order Submission Failed</h4>
                            <p><strong>Error:</strong> ${data.message}</p>
                        </div>
                    `;
                }
                
                submitButton.disabled = false;
                submitButton.textContent = 'Submit Test Order to OrderDesk';
            })
            .catch(error => {
                console.error('Error:', error);
                const messageContainer = document.getElementById('message-container');
                messageContainer.innerHTML = `
                    <div class="error-message">
                        <h4>Network Error</h4>
                        <p>Failed to submit order. Please check the console for details.</p>
                    </div>
                `;
                
                submitButton.disabled = false;
                submitButton.textContent = 'Submit Test Order to OrderDesk';
            });
        });

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateProductInfo();
        });
    </script>
</body>
</html>
